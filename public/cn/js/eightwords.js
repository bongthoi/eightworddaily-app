//all languages share the same file, convert the solar calendar to lunar calendar.
//先換算陽曆至陰曆

var vlunaryear = "";
var vlunarmonth = "";
var vmonthday = "";

function msg(lang){
	//get the value from the selects
    var vyear = document.getElementById("bornyear").value;  //document.getElementById("bornyear").innerHTML = res;
	var vmonth = document.getElementById("bornmonth").value;
	var vday = document.getElementById("bornday").value;
	var vhour = document.getElementById("bornhour").value;
	//alert(vyear + vmonth + vday + vhour);
	var yindex = checkYear(vyear);
    vmonthday = vmonth + vday
	var lastlunardata = checkLastLunarMonth(yindex, vmonthday);   //1967...040509
	var vlunardata = checkLastLunarMonth(yindex, vmonthday);
    //alert("lunar data = " + lastlunardata); 
	//alert("born month day = " + vmonthday);
	var vlunarday = checklunarday(vyear,lastlunardata, vmonthday);
    //alert(vlunarday);
	vlunaryear = vlunardata.substring(0,4);
	vlunarmonth = vlunardata.substring(4,6);
	if(lang == "vn"){
		document.getElementById("lunarmonthday").value = "Âm Lịch:" + vlunaryear + " Tháng:" + vlunarmonth + " Ngày:" + vlunarday;
	}else if(lang == "en"){
		document.getElementById("lunarmonthday").value = "Lunar Calender:" + vlunaryear + " Month:" + vlunarmonth + " Day:" + vlunarday;
	}else if(lang == "cn"){
		document.getElementById("lunarmonthday").value = "農曆:" + vlunaryear + " 月:" + vlunarmonth + " 日:" + vlunarday;
	}
	document.getElementById("secshowtamtus").style.display = 'block';
}
	
function checkYear(bornYear){
    var yearsIndex = 0;
	var len = years.length;
	
    for(var i=0; i < len; i++) {
        if (years[i][0] == bornYear) {
            yearsIndex = i;
        }
    }	
    return  yearsIndex;
}

function checkLastLunarMonth(pyearindex, pbornMonthDay){
    var vResult = "";	
    if(parseInt(pbornMonthDay) < parseInt(years[pyearindex][1].substring(2))){ //if the lunar born day is in last year
		var mlength = 0; 
        if(years[pyearindex-1].length > 13){ 
			mlength = 13;
		}else{
			mlength = 12;
		}
        if(pbornMonthDay < parseInt(years[pyearindex-1][mlength].substring(2))){		
            vResult = years[pyearindex - 1][0] + years[pyearindex - 1][mlength-1]; 
        }else{			
            vResult = years[pyearindex - 1][0] + years[pyearindex - 1][mlength];
        }
    }else{  
        vResult = checklunarMonth(pyearindex,pbornMonthDay)	
    }
    return vResult;
}

//use in the checkLastLunarMonth to return vResult if it is in the same year. This function is private.
function checklunarMonth(pyearindex2, pbornMonthDay2){
	var yearcheck;
	var len = years[pyearindex2].length;
	var lastmonthindex;
		for (var i = 1; i < len; i++) {
			if(years[pyearindex2][i].substring(2,4) == "12"){
				lastmonthindex = i;
				break;
			}				
		}
		if(parseInt(years[pyearindex2][lastmonthindex].substring(2)) < parseInt(pbornMonthDay2)) { // born month and day bigger than the last month starting day
            yearcheck = years[pyearindex2][0] + years[pyearindex2][lastmonthindex];  //confirm born month and day is in lunar 12 && is in Dec
		}else{
            //find the data. Stop when the data is bigger than the born month day and send the starting day of last month. So if bigger than last data
			//should only transfer the Nov
            for (var i = 1; i < len; i++) {
                var vData = years[pyearindex2][i].substring(2);
                if (parseInt(vData) > parseInt(pbornMonthDay2)) {
					yearcheck = years[pyearindex2][0] + years[pyearindex2][i-1];
					break;
                }
            }
        }	
					
	return yearcheck
}

function checklunarday(year, lunardata, bornmonthday){
    var lunarmonth;
	var lunarmonthdays;
    var lunarday;
    var bornmonth;
	var bornmonthdays;
    var bornday;
    var lunartotal;
    var borntotal;
	var bornlunarday;
    //1月4日就是0+4, 2月4日就是31+4, 3月4日是59+4, 4月4日是90+4, 五月9日是120+9, 6月4日是151+4.. 12月4日是334 +4, 加前面月數加自己日數
    var specialyear = [0,31,60,91,121,152,182,213,244,274,305,335,366];  //閏年
	var normalyear = [0,31,59,90,120,151,181,212,243,273,304,334,365];  //平年 	
	if(year % 4 == 0){   //閏年
		lunarmonth = lunardata.substring(6,8); 
		lunarmonthdays = specialyear[parseInt(lunarmonth) -1];
		bornmonth = bornmonthday.substring(0,2);
		bornmonthdays = specialyear[parseInt(bornmonth)-1];
	}else{  //平年
	    lunarmonth = lunardata.substring(6,8);  //1967040509
		lunarmonthdays = normalyear[parseInt(lunarmonth)-1];
		bornmonth = bornmonthday.substring(0,2);
		bornmonthdays = normalyear[parseInt(bornmonth)-1];
	}
	lunarday = lunardata.substring(8);
	bornday = bornmonthday.substring(2);	
    lunartotal = lunarmonthdays + parseInt(lunarday);
	if((parseInt(lunarmonth) == 12) && (parseInt(bornmonth) == 1)){  
		if(year % 4 == 0){ 
			borntotal = 366 + parseInt(bornday);
		}else{			
			borntotal = 365 + parseInt(bornday);
		}
	}else{
		borntotal = bornmonthdays + parseInt(bornday);
	}	
	bornlunarday = borntotal - lunartotal + 1;
    return bornlunarday
}

var y1949 = ["1949","010129","020228","030329","040428","050528","060626","070726","070824","080922","091022","101120","111220","120118"]
var y1950 = ["1950","010217","020318","030417","040517","050615","060715","070814","080912","091011","101110","111209","0120108"]
var y1951 = ["1951","010206","020308","030406","040506","050605","060704","070803","080901","091001","101030","111129","121228"]
var y1952 = ["1952","010127","020225","030326","040424","050524","050622","060722","070820","080919","091019","101117","111217","120115"]
var y1953 = ["1953","010214","020315","030414","040513","050611","060711","070810","080908","091008","101107","111206","120105"]
var y1954 = ["1954","010203","020305","030403","040503","050601","060630","070701","080828","090927","101027","111125","121225"]
var y1955 = ["1955","010124","020222","030324","030422","040522","050620","060719","070818","080916","091017","101114","111214","120113"]
var y1956 = ["1956","010212","020312","030411","040510","050609","060708","070806","080905","091004","101103","111202","120101"]
var y1957 = ["1957","010131","020302","030331","040430","050529","060601","070727","080801","080924","091023","101122","111221","120120"]
var y1958 = ["1958","010218","020320","030419","040519","050617","060717","070815","080913","091013","101111","111211","120109"]
var y1959 = ["1959","010208","020309","030408","040508","050606","060706","070804","080801","091002","101101","111130","121230"]
var y1960 = ["1960","010128","020227","030327","040426","050525","060624","060724","070822","080921","091020","101119","111218","120117"]
var y1961 = ["1961","010215","020317","030415","040515","050613","060713","070811","080910","091010","101108","111208","120106"]
var y1962 = ["1962","010205","020306","030405","040504","050602","060702","070731","080830","090929","101028","111127","121227"]
var y1963 = ["1963","010125","020224","030325","040424","040523","050621","060721","070819","080918","091017","101116","111216","120115"]
var y1964 = ["1964","010213","020314","030412","040512","050610","060709","070808","080906","091006","101104","111204","120103"]
var y1965 = ["1965","010202","020303","030402","040501","050531","060629","070728","080827","090925","101024","111123","121223"]
var y1966 = ["1966","010121","020220","030322","030421","040520","050619","060718","070816","080915","091014","101112","111212","120111"]
var y1967 = ["1967","010209","020311","030410","040509","050608","060708","070806","080904","091004","101102","111202","121231"]
var y1968 = ["1968","010130","020228","030329","040427","050527","060626","070725","070824","080922","091022","101120","111220","120118"]
var y1969 = ["1969","010217","020318","030417","040516","050615","060714","070813","080912","091011","101110","111209","120108"]
var y1970 = ["1970","010206","020308","030406","040505","050604","060703","070802","080901","090930","101030","111129","121228"]
var y1971 = ["1971","010127","020225","030327","040401","050524","050623","060722","070821","080919","091019","101118","111218","120116"]
var y1972 = ["1972","010215","020315","030414","040513","050611","060711","070809","080908","091007","101106","111206","120104"]
var y1973 = ["1973","010203","020305","030403","040503","050601","060630","070730","080828","090926","101026","111125","121224"]
var y1974 = ["1974","010123","020222","030324","040422","040522","050620","060719","070818","080916","091015","101114","111214","120112"]
var y1975 = ["1975","010211","020313","030412","040511","050610","060709","070807","080906","091005","101103","111203","120101"]
var y1976 = ["1976","010131","020301","030331","040429","050529","060627","070727","080825","080924","091023","101121","111221","120119"]
var y1977 = ["1977","010218","020320","030418","040518","050617","060716","070815","080913","091013","101111","111211","120109"]
var y1978 = ["1978","010207","020309","030407","040507","050606","060705","070804","080903","091002","101101","111130","121230"]
var y1979 = ["1979","010128","020227","030328","040426","050526","060624","060724","070823","080921","091021","101120","111219","120118"]
var y1980 = ["1980","010216","020317","030415","040514","050613","060712","070811","080909","091009","101108","111207","120106"]
var y1981 = ["1981","010205","020306","030405","040504","050602","060702","070731","080829","090928","101028","111126","121226"]
var y1982 = ["1982","010125","020224","030325","040424","040523","050621","060721","070819","080917","091017","101115","111215","120114"]
var y1983 = ["1983","010213","020313","030413","040513","050611","060710","070809","080907","091006","101105","111204","120103"]
var y1984 = ["1984","010202","020303","030401","040501","050531","060629","070728","080827","090925","101024","101123","111222","120121"]
var y1985 = ["1985","010220","020321","030420","040520","050618","060718","070816","080915","091014","101112","111212","120110"]
var y1986 = ["1986","010209","020310","030409","040509","050607","060707","070806","080904","091004","101102","111202","121231"]
var y1987 = ["1987","010129","020228","030329","040428","050527","060626","060726","070824","080923","091023","101121","111221","120119"]
var y1988 = ["1988","010217","020318","030416","040516","050614","060714","070812","080911","091011","101109","111209","120108"]
var y1989 = ["1989","010206","020308","030406","040505","050604","060703","070801","080831","090930","101029","111127","121201"]
var y1990 = ["1990","010127","020225","030327","040425","050524","050623","060722","070820","080919","091018","101117","111217","120116"]
var y1991 = ["1991","010215","020316","030415","040514","050612","060712","070810","080908","091008","101106","111206","120105"]
var y1992 = ["1992","010204","020304","030403","040503","050601","060630","070730","080828","090926","101026","111124","121224"]
var y1993 = ["1993","010123","020221","030323","030422","040521","050620","060719","070818","080916","091015","101114","111213","120112"]
var y1994 = ["1994","010210","020312","030411","040511","050609","060709","070807","080906","091005","101103","111203","120101"]
var y1995 = ["1995","010131","020301","030331","040430","050529","060628","070727","080826","080925","091024","101122","111222","120120"]
var y1996 = ["1996","010219","020319","030418","040517","050616","060716","070814","080913","091012","101111","111211","120109"]
var y1997 = ["1997","010207","020309","030407","040507","050605","060705","070803","080902","091002","101031","111130","121230"]
var y1998 = ["1998","010128","020227","030328","040426","050526","050624","060723","070822","080921","091020","101119","111219","120117"]
var y1999 = ["1999","010216","020318","030416","040515","050614","060713","070811","080910","091009","101108","111208","120107"]
var y2000 = ["2000","010205","020306","030405","040504","050602","060702","070731","080829","090928","101027","111126","121226"]
var y2001 = ["2001","010124","020223","030325","040423","040523","050621","060721","070819","080917","091017","101115","111215","120113"]
var y2002 = ["2002","010212","020314","030413","040512","050611","060710","070809","080907","091006","101105","111204","120103"]
var y2003 = ["2003","010201","020303","030402","040501","050531","060630","070729","080828","090926","101025","111124","121223"]
var y2004 = ["2004","010122","020220","020321","030419","040519","050618","060717","070816","080914","091014","101112","111212","120110"]
var y2005 = ["2005","010209","020310","030409","040508","050607","060706","070805","080904","091003","101102","111201","121231"]
var y2006 = ["2006","010129","020228","030329","040428","050527","060626","070725","070824","080922","091022","101121","111220","120119"]
var y2007 = ["2007","010218","020319","030417","040517","050615","060714","070813","080911","091011","101110","111210","120108"]
var y2008 = ["2008","010207","020308","030406","040505","050604","060703","070801","080831","090929","101029","111128","121227"]
var y2009 = ["2009","010126","020225","030327","040425","050524","050623","060722","070820","080919","091018","101118","111216","120115"]
var y2010 = ["2010","010214","020316","030414","040514","050612","060712","070810","080908","091008","101106","111206","120104"]
var y2011 = ["2011","010203","020305","030403","040503","050602","060701","070731","080829","090927","101027","111125","121225"]
var y2012 = ["2012","010123","020222","030322","040421","040521","050619","060719","070817","080916","091015","101114","111213","120112"]
var y2013 = ["2013","010210","020312","030410","040510","050608","060708","070807","080905","091005","101103","111203","121201"]
var y2014 = ["2014","010131","020301","030331","040429","050529","060627","070727","080825","090924","091024","101122","111222","120120"]
var y2015 = ["2015","010219","020320","030419","040518","050616","060716","070814","080913","091013","101112","111211","120110"]
var y2016 = ["2016","010208","020309","030407","040507","050605","060704","070803","080901","091001","101031","111129","121229"]
var y2017 = ["2017","010128","020226","030328","040426","050526","060624","060723","070822","080920","091020","101118","111218","120117"]
var y2018 = ["2018","010216","020317","030416","040515","050614","060713","070811","080910","091009","101108","111207","120106"]
var y2019 = ["2019","010205","020307","030405","040505","050603","060703","070801","080830","090929","101028","111126","121226"]
var y2020 = ["2020","010125","020223","030324","040423","040523","050621","060721","070819","080917","091017","101115","111215","120113"]
var y2021 = ["2021","010212","020313","030412","040512","050610","060710","070808","080907","091006","101105","111204","120103"]
var y2022 = ["2022","010201","020303","030401","040501","050530","060629","070729","080827","090926","101025","111124","121223"]
var y2023 = ["2023","010122","020220","020322","030420","040519","050618","060718","070816","080915","091015","101113","111213","120111"]
var y2024 = ["2024","010210","020310","030409","040508","050606","060706","070804","080903","091003","101101","111201","121231"]
var y2025 = ["2025","010129","020228","030329","040428","050527","060625","060725","070823","080922","091021","101120","111220","120119"]

var years=[y1949,y1950,y1951,y1952,y1953,y1954,y1955,y1956,y1957,y1958,y1959,y1960,
y1961,y1962,y1963,y1964,y1965,y1966,y1967,y1968,y1969,y1970,y1971,y1972,y1973,y1974,y1975,y1976,y1977,y1978,y1979,y1980,
y1981,y1982,y1983,y1984,y1985,y1986,y1987,y1988,y1989,y1990,y1991,y1992,y1993,y1994,y1995,y1996,y1997,y1998,y1999,y2000,
y2001,y2002,y2003,y2004,y2005,y2006,y2007,y2008,y2009,y2010,y2011,y2012,y2013,y2014,y2015,y2016,y2017,y2018,
y2019,y2020,y2021,y2022,y2023,y2024,y2025
]

